<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Invoice | HisabLink Google Style</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap');

    body {
      font-family: 'Roboto', sans-serif;
      background: #fafafa;
      color: #202124;
    }

    @page { size: A4; margin: 18mm; }

    @media print {
      html, body {
        width: 210mm;
        height: 297mm;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
      .no-print { display: none !important; }
      .shadow-lg, .border { box-shadow: none !important; border: none !important; }
    }

    .label {
      color: #5f6368;
      font-weight: 500;
    }

    .divider {
      border-top: 1px solid #e0e0e0;
    }
  </style>
</head>

<body class="flex justify-center p-6">

  <div class="bg-white shadow-md rounded-xl w-[210mm] min-h-[297mm] px-10 py-8 border border-gray-100">

    <!-- HEADER -->
    <div class="flex justify-between items-start">
      <div class="flex items-center gap-4">
        <img id="bizLogo" class="w-16 h-16 object-contain hidden" alt="Logo" />
        <div>
          <h1 id="bizName" class="text-2xl font-semibold tracking-tight text-gray-900">HisabLink Technologies Pvt. Ltd.</h1>
          <p id="bizAddress" class="text-sm text-gray-600">Address Line, City, State</p>
          <p id="bizGST" class="text-xs text-gray-500 mt-1">GSTIN: ‚Äî</p>
        </div>
      </div>
      <div class="text-right">
        <h2 class="text-3xl font-bold text-blue-600">INVOICE</h2>
        <p id="invoiceId" class="text-sm text-gray-600 mt-1">#INV0001</p>
      </div>
    </div>

    <!-- META INFO -->
    <div class="grid grid-cols-2 text-sm mt-8">
      <div>
        <p><span class="label">Invoice Date:</span> <span id="invoiceDate">‚Äî</span></p>
        <p><span class="label">Due Date:</span> <span id="dueDate">‚Äî</span></p>
        <p><span class="label">Terms:</span> Net 7 Days</p>
      </div>
      <div class="text-right">
        <p><span class="label">Invoice No:</span> <span id="invoiceNumber">INV-0001</span></p>
        <p><span class="label">Currency:</span> INR (‚Çπ)</p>
      </div>
    </div>

    <div class="divider my-6"></div>

    <!-- CUSTOMER -->
    <div class="grid grid-cols-2 text-sm">
      <div>
        <h3 class="font-semibold text-gray-800 mb-2">Bill To</h3>
        <p id="customerName" class="font-medium text-gray-900">Customer Name</p>
        <p id="customerGST" class="text-xs text-gray-600"></p>
        <p id="customerEmail" class="text-xs text-gray-600"></p>
        <p id="customerPhone" class="text-xs text-gray-600"></p>
        <p id="customerAddress" class="text-xs text-gray-600"></p>
      </div>
      <div>
        <h3 class="font-semibold text-gray-800 mb-2">Ship To</h3>
        <p id="shipToName" class="font-medium text-gray-900">Same as Billing</p>
        <p id="shipToAddress" class="text-xs text-gray-600"></p>
      </div>
    </div>

    <div class="divider my-6"></div>

    <!-- ITEMS -->
    <table class="w-full text-sm border-collapse">
      <thead>
        <tr class="text-left text-gray-700 bg-gray-50 border-b">
          <th class="py-2 px-3">Item</th>
          <th class="py-2 px-3 text-center">Qty</th>
          <th class="py-2 px-3 text-right">Rate (‚Çπ)</th>
          <th class="py-2 px-3 text-right">Tax (%)</th>
          <th class="py-2 px-3 text-right">Amount (‚Çπ)</th>
        </tr>
      </thead>
      <tbody id="invoiceItems" class="divide-y divide-gray-100"></tbody>
    </table>

    <!-- TOTALS -->
    <div class="flex justify-end mt-8">
      <div class="text-sm w-72">
        <div class="flex justify-between py-1"><span class="label">Subtotal</span><span id="subTotalDisplay">‚Çπ0.00</span></div>
        <div class="flex justify-between py-1"><span class="label">Tax</span><span id="taxDisplay">‚Çπ0.00</span></div>
        <div class="divider my-1"></div>
        <div class="flex justify-between py-2 font-semibold text-lg text-blue-700"><span>Total</span><span id="grandTotalDisplay">‚Çπ0.00</span></div>
      </div>
    </div>

    <!-- BANK INFO -->
    <div id="bankDetails" class="text-xs text-gray-700 mt-8 hidden">
      <p class="font-semibold text-gray-800 mb-1">Payment Information</p>
      <p id="bankName"></p>
      <p id="accountNumber"></p>
      <p id="ifsc"></p>
      <p id="upiId"></p>
    </div>

    <!-- NOTES -->
    <div class="mt-8 text-xs text-gray-600">
      <p class="font-medium text-gray-700 mb-1">Notes</p>
      <p>Thank you for using HisabLink. This invoice was generated automatically.</p>
    </div>

    <div class="mt-2 text-xs text-gray-500">
      <p>For queries, reach us at <span id="bizEmailFooter">support@hisablink.com</span></p>
    </div>

    <!-- FOOTER -->
    <div class="text-center text-xs text-gray-400 border-t mt-8 pt-3">
      ¬© 2025 Hyquantix Technologies Pvt. Ltd. | Smart Billing Platform
    </div>
  </div>

  <!-- Print -->
  <div class="no-print text-center mt-6">
    <button onclick="window.print()" class="bg-blue-600 text-white px-8 py-2 rounded-md hover:bg-blue-700 transition">üñ®Ô∏è Print / Download PDF</button>
  </div>

  <!-- FIRESTORE -->
  <script type="module">
    import { db, doc, getDoc } from "./firebase.js";

    async function loadInvoice() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("inv");
      if (!id) return alert("Invoice ID missing");

      const invSnap = await getDoc(doc(db, "invoices", id));
      if (!invSnap.exists()) return alert("Invoice not found");

      const inv = invSnap.data();

      // Invoice Meta
      document.getElementById("invoiceId").textContent = "#" + id.slice(-6);
      document.getElementById("invoiceNumber").textContent = id.slice(-6);
      document.getElementById("invoiceDate").textContent = inv.createdAt?.toDate().toLocaleDateString() || "-";
      document.getElementById("dueDate").textContent = inv.dueDate || "-";

      // Customer Info
      document.getElementById("customerName").textContent = inv.customerName || "N/A";
      document.getElementById("customerGST").textContent = inv.customerGST ? "GSTIN: " + inv.customerGST : "";
      document.getElementById("customerEmail").textContent = inv.customerEmail || "";
      document.getElementById("customerPhone").textContent = inv.customerPhone || "";
      document.getElementById("customerAddress").textContent = inv.customerAddress || "";
      document.getElementById("shipToAddress").textContent = inv.shipTo || "Same as billing";

      // Items
      const tbody = document.getElementById("invoiceItems");
      tbody.innerHTML = "";
      (inv.items || []).forEach((i) => {
        const total = (i.qty * i.price * (1 + (i.tax || 0) / 100)).toFixed(2);
        tbody.innerHTML += `
          <tr>
            <td class="py-2 px-3 text-gray-800">${i.name}<p class="text-xs text-gray-500">${i.desc || ""}</p></td>
            <td class="py-2 px-3 text-center">${i.qty}</td>
            <td class="py-2 px-3 text-right">‚Çπ${i.price}</td>
            <td class="py-2 px-3 text-right">${i.tax || 0}%</td>
            <td class="py-2 px-3 text-right">‚Çπ${total}</td>
          </tr>`;
      });

      // Totals
      document.getElementById("subTotalDisplay").textContent = "‚Çπ" + (inv.subtotal || 0).toFixed(2);
      document.getElementById("taxDisplay").textContent = "‚Çπ" + (inv.tax || 0).toFixed(2);
      document.getElementById("grandTotalDisplay").textContent = "‚Çπ" + (inv.total || 0).toFixed(2);

      // Business Info
      if (inv.userId) {
        const bizSnap = await getDoc(doc(db, "businessProfile", inv.userId));
        if (bizSnap.exists()) {
          const b = bizSnap.data();
          document.getElementById("bizName").textContent = b.companyName || "Your Company";
          document.getElementById("bizGST").textContent = b.gstin ? `GSTIN: ${b.gstin}` : "GSTIN: ‚Äî";
          document.getElementById("bizAddress").textContent = b.address || "";
          document.getElementById("bizEmailFooter").textContent = b.email || "support@hisablink.com";

          if (b.logoUrl) {
            const logo = document.getElementById("bizLogo");
            logo.src = b.logoUrl;
            logo.classList.remove("hidden");
          }

          if (b.bankName || b.accountNumber || b.ifsc || b.upiId) {
            const bank = document.getElementById("bankDetails");
            document.getElementById("bankName").textContent = b.bankName ? `üè¶ ${b.bankName}` : "";
            document.getElementById("accountNumber").textContent = b.accountNumber ? `A/C No: ${b.accountNumber}` : "";
            document.getElementById("ifsc").textContent = b.ifsc ? `IFSC: ${b.ifsc}` : "";
            document.getElementById("upiId").textContent = b.upiId ? `UPI: ${b.upiId}` : "";
            bank.classList.remove("hidden");
          }
        }
      }
    }
    loadInvoice();
  </script>
</body>
</html>
