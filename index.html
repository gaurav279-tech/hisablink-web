<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Invoice â€” HisabLink</title>
<link rel="stylesheet" href="styles.css">
<style>
.invoice-box {
  background: white;
  border-radius: 16px;
  border: 1px solid var(--border);
  padding: 28px;
  width: min(880px, 96vw);
  font-size: 15px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  animation: fadeIn .4s ease;
}
@keyframes fadeIn {
  from {opacity:0; transform: translateY(10px);} 
  to {opacity:1; transform: translateY(0);}
}
.header-title { font-size: 28px; font-weight: 800; }
.bill-block {
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 14px;
  background: #fff;
}
.section-title { font-weight: 700; margin-bottom: 6px; font-size: 15px; }
.status-pill {
  padding: 6px 12px;
  font-size: 13px;
  font-weight: 600;
  border-radius: 999px;
  text-transform: uppercase;
}
.status-paid { background:#d4f7d8; color:#147a1a; }
.status-sent { background:#ffeab7;color:#b17700; }
.status-overdue { background:#ffd3d3;color:#b30000; }
.pay-buttons {
  display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;
}
.btn-line {
  border:1px solid var(--gold);
  background:#fff;
  padding:.65rem 1rem;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

<div class="invoice-box">

  <!-- Header -->
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <div>
      <div class="header-title">Invoice</div>
      <div style="color:var(--muted);font-size:14px">Hisab<span style="color:var(--gold)">Link</span></div>
    </div>

    <div style="text-align:right">
      <span id="statusBadge" class="status-pill status-sent">PENDING</span>
      <div style="background:var(--gold);color:white;width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;margin-top:8px">
        HL
      </div>
    </div>
  </div>

  <hr style="border:none;border-top:1px solid var(--border);margin:12px 0">

  <!-- Details -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:10px" id="invMeta"></div>

  <!-- Items -->
  <table class="table" style="margin-top:20px">
    <thead>
      <tr><th>Item</th><th>Qty</th><th>Price</th><th>Tax%</th><th>Total</th></tr>
    </thead>
    <tbody id="invBody"></tbody>
  </table>

  <!-- Footer summary -->
  <div style="display:grid;grid-template-columns:1fr 260px;gap:20px;margin-top:16px">
    <div>
      <div class="section-title">Notes</div>
      <div id="invNotes" style="color:var(--muted);font-size:14px"></div>

      <div class="section-title" style="margin-top:12px">Terms</div>
      <div id="invTerms" style="color:var(--muted);font-size:14px"></div>
    </div>
    <div>
      <div class="kpi"><h4>Subtotal</h4><span id="sub">0</span></div>
      <div class="kpi" style="margin-top:8px"><h4>Tax</h4><span id="tax">0</span></div>
      <div class="kpi" style="margin-top:8px"><h4>Total</h4><span id="tot">0</span></div>

      <div class="pay-buttons">
        <button id="payBtn" class="btn" style="flex:1">ðŸ’³ Pay Now</button>
        <button id="dlBtn" class="btn-line" style="flex:1">ðŸ“„ Download PDF</button>
        <button id="copyBtn" class="btn-line" style="flex:1">ðŸ”— Copy Link</button>
      </div>
    </div>
  </div>
</div>

<script type="module">
import "./firebase.js";
import { db, doc, getDoc } from "./firebase.js";

const id = new URL(location.href).searchParams.get("id");
if(!id){ document.body.innerHTML="<p>Missing invoice ID.</p>"; }

const snap = await getDoc(doc(db,"invoices",id));
if(!snap.exists()){ document.body.innerHTML="<p>Invoice not found.</p>"; }
const inv = snap.data();

/* Status Badge */
const s = inv.status || "sent";
const b = document.getElementById("statusBadge");
b.textContent = s.toUpperCase();
if(s==="paid") b.className="status-pill status-paid";
else if(s==="overdue") b.className="status-pill status-overdue";
else b.className="status-pill status-sent";

/* Meta Data */
document.getElementById("invMeta").innerHTML = `
<div class='bill-block'>
  <div class="section-title">Invoice Info</div>
  <div><b>No:</b> ${inv.number}</div>
  <div><b>Issue:</b> ${inv.issueDate}</div>
  <div><b>Due:</b> ${inv.dueDate}</div>
</div>
<div class='bill-block'>
  <div class="section-title">Bill To</div>
  <div><b>${inv.customer?.name || ""}</b></div>
  <div>${inv.customer?.email || ""}</div>
  <div>${inv.customer?.phone || ""}</div>
</div>
`;

/* Items */
inv.items?.forEach(it=>{
  const line = it.qty * it.price;
  const tax = line*(it.tax/100);
  document.getElementById("invBody").innerHTML += `
  <tr>
    <td>${it.name}</td>
    <td>${it.qty}</td>
    <td>â‚¹${it.price.toFixed(2)}</td>
    <td>${it.tax}%</td>
    <td>â‚¹${(line+tax).toFixed(2)}</td>
  </tr>`;
});

/* Totals */
document.getElementById("sub").textContent = inv.subtotal.toFixed(2);
document.getElementById("tax").textContent = inv.tax.toFixed(2);
document.getElementById("tot").textContent = inv.total.toFixed(2);

/* Notes + Terms */
document.getElementById("invNotes").textContent = inv.notes || "-";
document.getElementById("invTerms").textContent = inv.terms || "-";

/* Payment Button */
document.getElementById("payBtn").onclick = ()=>{
  const msg = encodeURIComponent(`Hi, please pay Invoice ${inv.number} of â‚¹${inv.total}.`);
  window.open(`https://wa.me/?text=${msg}`);
};

/* Copy Link */
document.getElementById("copyBtn").onclick = ()=>{
  navigator.clipboard.writeText(location.href);
  alert("Invoice link copied âœ…");
};

/* Download PDF â€” Placeholder for now */
document.getElementById("dlBtn").onclick = ()=>{
  alert("PDF coming next build ðŸ“„âœ¨");
};
</script>
</body>
</html>
